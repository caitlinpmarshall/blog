!function(i){var e=function(e){if(!e.data("initialized")){var t=wp.oldEditor?wp.oldEditor:wp.editor;t&&t.hasOwnProperty("autop")&&(wp.editor.autop=t.autop,wp.editor.removep=t.removep,wp.editor.initialize=t.initialize);var n,o=e.find(".siteorigin-widget-tinymce-container"),r=o.data("editorSettings");if(tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit.hasOwnProperty("content")){var a=tinyMCEPreInit.mceInit.content;if(a.hasOwnProperty("content_css")&&a.content_css){var c=a.content_css.split(",");if(r.tinymce.hasOwnProperty("content_css")&&r.tinymce.content_css)for(var d=0;d<c.length;d++){var s=c[d];-1===r.tinymce.content_css.indexOf(s)&&(r.tinymce.content_css+=","+s)}else r.tinymce.content_css=c}}if(r.wpautopToggleField){var l=o.closest(".siteorigin-widget-form");n=l.find(r.wpautopToggleField),r.tinymce.wpautop=n.is(":checked")}var f=o.find("textarea");if(!(m=f.data("tinymce-id"))){var m=f.attr("id")+Math.floor(1e3*Math.random());f.data("tinymce-id",m),f.attr("id",m)}if(r.tinymce&&(r.tinymce=i.extend({},r.tinymce,{selector:"#"+m,setup:function(i){i.on("change",(function(){window.tinymce.get(m).save(),f.trigger("change")})),n&&(n.off("change"),n.on("change",(function(){wp.editor.remove(m),r.tinymce.wpautop=n.is(":checked"),wp.editor.initialize(m,r)})))}})),i(document).on("wp-before-tinymce-init",(function(i,t){if(t.selector===r.tinymce.selector){var n=o.data("mediaButtons");0===e.find(".wp-media-buttons").length&&e.find(".wp-editor-tabs").before(n.html);var a=o.find("textarea");e.find(".add_media").attr("data-editor",a.data("tinymce-id"))}})),i(document).on("tinymce-editor-setup",(function(){var i=e.find(".wp-editor-wrap");i.length>0&&!i.hasClass(r.selectedEditor+"-active")&&setTimeout((function(){window.switchEditors.go(m)}),10)})),t.remove(m),window.tinymce&&window.tinymce.EditorManager.overrideDefaults({base_url:r.baseURL,suffix:r.suffix}),f.is(":visible"))t.initialize(m,r);else var w=setInterval((function(){f.is(":visible")&&(t.initialize(m,r),clearInterval(w))}),500);e.on("click",(function(t){var n=i(t.target);if(n.is(".wp-switch-editor")){var o=n.hasClass("switch-tmce")?"tmce":"html";if("tmce"===o){var a=window.tinymce.get(m);if(null!==a){var c=f.val();-1!==c.search("<")&&-1===c.search(">")&&(c=c.replace(/</g,""),f.val(c)),a.setContent(window.switchEditors.wpautop(c))}}r.selectedEditor=o,e.find(".siteorigin-widget-tinymce-selected-editor").val(o)}})),e.data("initialized",!0)}};i(document).on("sowsetupformfield",".siteorigin-widget-field-type-tinymce",(function(){var t=i(this),n=t.closest(".siteorigin-widget-field-repeater-item-form");n.length>0?n.is(":visible")?e(t):n.on("slideToggleOpenComplete",(function(){n.is(":visible")&&(e(t),n.off("slideToggleOpenComplete"))})):e(t)})),i(document).on("sortstop",(function(t,n){(n.item.is(".siteorigin-widget-field-repeater-item")?n.item.find("> .siteorigin-widget-field-repeater-item-form"):n.item.find(".siteorigin-widget-form")).find(".siteorigin-widget-field-type-tinymce").each((function(){i(this).data("initialized",null),e(i(this))}))}))}(jQuery);